fragment_downloaded_cb({"url": "Creating-Linux-binaries.html#page-description", "fragment": "<div id=\"page-description\" data-hotdoc-source=\"Creating-Linux-binaries.md\">\n<h1 id=\"creating-linux-binaries\">Creating Linux binaries</h1>\n<p>Creating Linux binaries that can be downloaded and run on any distro (like .dmg packages for OSX or .exe installers for Windows) has traditionally been difficult. This is even more tricky if you want to use modern compilers and features, which is especially desired in game development. There is still no simple turn key solution for this problem but with a bit of setup it can be relatively straightforward.</p>\n<h2 id=\"installing-system-and-gcc\">Installing system and GCC</h2>\n<p>First you need to do a fresh operating system install. You can use spare hardware, VirtualBox, cloud or whatever you want. Note that the distro you install must be <em>at least as old</em> as the oldest release you wish to support. Debian stable is usually a good choice, though immediately after its release you might want to use Debian oldstable or the previous Ubuntu LTS. The oldest supported version of CentOS is also a good choice.</p>\n<p>Once you have installed the system, you need to install build dependencies for GCC. In Debian based distros this can be done with the following commands:</p>\n<pre><code class=\"language-console\">$ apt get build dep g++\n$ apt get install pkg config libgmp dev libmpfr dev libmpc dev\n</code></pre>\n<p>Then create a <code>src</code> subdirectory in your home directory. Copypaste the following into <code>install_gcc.sh</code> and execute it.</p>\n<pre><code class=\"language-bash\">#!/bin/sh\n\nwget ftp://ftp.fu berlin.de/unix/languages/gcc/releases/gcc 4.9.2/gcc 4.9.2.tar.bz2\ntar xf gcc 4.9.2.tar.bz2\n\nmkdir objdir\ncd objdir\n../gcc 4.9.2/configure   disable bootstrap   prefix=${HOME}/devroot \\\n                         disable multilib   enable languages=c,c++\nmake  j 4\nmake install strip\nln  s gcc ${HOME}/devroot/bin/cc\n</code></pre>\n<p>Then finally add the following lines to your <code>.bashrc</code>.</p>\n<pre><code class=\"language-console\">$ export LD_LIBRARY_PATH=${HOME}/devroot/lib\n$ export PATH=${HOME}/devroot/bin:$PATH\n$ export PKG_CONFIG_PATH=${HOME}/devroot/lib/pkgconfig\n</code></pre>\n<p>Log out and back in and now your build environment is ready to use.</p>\n<h2 id=\"adding-other-tools\">Adding other tools</h2>\n<p>Old distros might have too old versions of some tools. For Meson this could include Python 3 and Ninja. If this is the case you need to download, build and install new versions into <code>~/devroot</code> in the usual way.</p>\n<h2 id=\"adding-dependencies\">Adding dependencies</h2>\n<p>You want to embed and statically link every dependency you can (especially C++ dependencies). Meson's [Wrap package manager might be of use here](Wrap dependency system manual). This is equivalent to what you would do on Windows, OSX, Android etc. Sometimes static linking is not possible. In these cases you need to copy the .so files inside your package. Let's use SDL2 as an example. First we download and install it as usual giving it our custom install prefix (that is, <code>./configure prefix=${HOME}/devroot</code>). This makes Meson's dependency detector pick it up automatically.</p>\n<h2 id=\"building-and-installing\">Building and installing</h2>\n<p>Building happens in much the same way as normally. There are just two things to note. First, you must tell GCC to link the C++ standard library statically. If you don't then your app is guaranteed to break as different distros have binary incompatible C++ libraries. The second thing is that you need to point your install prefix to some empty staging area. Here's the meson command to do that:</p>\n<pre><code class=\"language-console\">$ LDFLAGS= static libstdc++ meson   prefix=/tmp/myapp &lt;other args&gt;\n</code></pre>\n<p>The aim is to put the executable in <code>/tmp/myapp/bin</code> and shared libraries to <code>/tmp/myapp/lib</code>. The next thing you need is the embedder. It takes your dependencies (in this case only <code>libSDL2 2.0.so.0</code>) and copies them in the lib directory. Depending on your use case you can either copy the files by hand or write a script that parses the output of <code>ldd binary_file</code>. Be sure not to copy system libraries (<code>libc</code>, <code>libpthread</code>, <code>libm</code> etc). For an example, see the <a href=\"https://github.com/jpakkane/meson/tree/master/manual%20tests/4%20standalone%20binaries\">sample project</a>.</p>\n<p>Make the script run during install with this:</p>\n<pre><code class=\"language-meson\">meson.set_install_script('linux_bundler.sh')\n</code></pre>\n<h2 id=\"final-steps\">Final steps</h2>\n<p>If you try to run the program now it will most likely fail to start or crashes. The reason for this is that the system does not know that the executable needs libraries from the <code>lib</code> directory. The solution for this is a simple wrapper script. Create a script called <code>myapp.sh</code> with the following content:</p>\n<pre><code class=\"language-bash\">#!/bin/bash\n\ncd \"${0%/*}\"\nexport LD_LIBRARY_PATH=\"`pwd`/lib\"\nbin/myapp\n</code></pre>\n<p>Install it with this Meson snippet:</p>\n<pre><code class=\"language-meson\">install_data('myapp.sh', install_dir : '.')\n</code></pre>\n<p>And now you are done. Zip up your <code>/tmp/myapp</code> directory and you have a working binary ready for deployment. To run the program, just unzip the file and run <code>myapp.sh</code>.</p>\n\n</div>\n\n\n        "});