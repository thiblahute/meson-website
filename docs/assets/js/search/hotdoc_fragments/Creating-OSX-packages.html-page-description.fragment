fragment_downloaded_cb({"url": "Creating-OSX-packages.html#page-description", "fragment": "<div id=\"page-description\" data-hotdoc-source=\"Creating-OSX-packages.md\">\n<h1 id=\"creating-osx-packages\">Creating OSX packages</h1>\n<p>Meson does not have native support for building OSX packages but it does provide all the tools you need to create one yourself. The reason for this is that it is a very hard task to write a system that provides for all the different ways to do that but it is very easy to write simple scripts for each application.</p>\n<p>Sample code for this can be found in <a href=\"https://github.com/jpakkane/meson/tree/master/manual%20tests/4%20standalone%20binaries\">the Meson manual test suite</a>.</p>\n<h2 id=\"creating-an-app-bundle\">Creating an app bundle</h2>\n<p>OSX app bundles are actually extremely simple. They are just a directory of files in a certain format. All the details you need to know are on <a href=\"https://stackoverflow.com/questions/1596945/building-osx-app-bundle\">this page</a> and it is highly recommended that you read it first.</p>\n<p>Let's assume that we are creating our app bundle into <code>/tmp/myapp.app</code>. Suppose we have one executable, so we need to install that into <code>Contents/MacOS</code>. If we define the executable like this:</p>\n<pre><code class=\"language-meson\">executable('myapp', 'foo1.c', ..., install : true)\n</code></pre>\n<p>then we just need to initialize our build tree with this command:</p>\n<pre><code class=\"language-console\">$ meson --prefix=/tmp/myapp.app \\\n        --bindir=Contents/MacOS \\\n        builddir \\\n        &lt;other flags you might need&gt;\n</code></pre>\n<p>Now when we do <code>ninja install</code> the bundle is properly staged. If you have any resource files or data, you need to install them into <code>Contents/Resources</code> either by custom install commands or specifying more install paths to the Meson command.</p>\n<p>Next we need to install an <code>Info.plist</code> file and an icon. For those we need the following two Meson definitions.</p>\n<pre><code class=\"language-meson\">install_data('myapp.icns', install_dir : 'Contents/Resources')\ninstall_data('Info.plist', install_dir : 'Contents')\n</code></pre>\n<p>The format of <code>Info.plist</code> can be found in the link or the sample project linked above. Be careful, the sample code on the linked page is malformed, it is missing a less than character (&lt;) before <code>!DOCTYPE</code>. The simplest way to get an icon in the <code>icns</code> format is to save your image as a tiff an then use the <code>tiff2icns</code> helper application that comes with XCode.</p>\n<p>Some applications assume that the working directory of the app process is the same where the binary executable is. If this is the case for you, then you need to create a wrapper script that looks like this:</p>\n<pre><code class=\"language-bash\">#!/bin/bash\n\ncd \"${0%/*}\"\n./myapp\n</code></pre>\n<p>install it with this:</p>\n<pre><code class=\"language-meson\">install_data('myapp.sh', install_dir : 'Contents/MacOS')\n</code></pre>\n<p>and make sure that you specify <code>myapp.sh</code> as the executable to run in your <code>Info.plist</code>.</p>\n<p>If you are not using any external libraries, this is all you need to do. You now have a full app bundle in <code>/tmp/myapp.app</code> that you can use. Most applications use third party frameworks and libraries, though, so you need to add them to the bundle so it will work on other peoples' machines.</p>\n<p>As an example we are going to use the <a href=\"https://libsdl.org/\">SDL2</a> framework. In order to bundle it in our app, we first specify an installer script to run.</p>\n<pre><code class=\"language-meson\">meson.set_install_script('install_script.sh')\n</code></pre>\n<p>The install script does two things. First it copies the whole framework into our bundle.</p>\n<pre><code class=\"language-console\">$ mkdir -p ${MESON_INSTALL_PREFIX}/Contents/Frameworks\n$ cp -R /Library/Frameworks/SDL2.framework \\\n        ${MESON_INSTALL_PREFIX}/Contents/Frameworks\n</code></pre>\n<p>Then it needs to alter the library search path of our executable(s). This tells OSX that the libraries your app needs are inside your bundle. In the case of SDL2, the invocation goes like this:</p>\n<pre><code class=\"language-console\">$ install_name_tool -change @rpath/SDL2.framework/Versions/A/SDL2 \\\n    @executable_path/../FrameWorks/SDL2.framework/Versions/A/SDL2 \\\n    ${MESON_INSTALL_PREFIX}/Contents/MacOS/myapp\n</code></pre>\n<p>This is the part of OSX app bundling that you must always do manually. OSX dependencies come in many shapes and forms and unfortunately there is no reliable automatic way to determine how each dependency should be handled. Frameworks go to the <code>Frameworks</code> directory while plain <code>.dylib</code> files usually go to <code>Contents/Resources/lib</code> (but you can put them wherever you like). To get this done you have to check what your program links against with <code>otool -L /path/to/binary</code> and manually add the copy and fix steps to your install script. Do not copy system libraries inside your bundle, though.</p>\n<p>After this you have a fully working, self-contained OSX app bundle ready for distribution.</p>\n<h2 id=\"creating-a-dmg-installer\">Creating a .dmg installer</h2>\n<p>A .dmg installer is similarly quite simple, at its core it is basically a fancy compressed archive. A good description can be found on <a href=\"https://el-tramo.be/guides/fancy-dmg/\">this page</a>. Please read it and create a template image file according to its instructions.</p>\n<p>The actual process of creating the installer is very simple: you mount the template image, copy your app bundle in it, unmount it and convert the image into a compressed archive. The actual commands to do this are not particularly interesting, feel free to steal them from either the linked page above or from the sample script in Meson's test suite.</p>\n<h2 id=\"putting-it-all-together\">Putting it all together</h2>\n<p>There are many ways to put the .dmg installer together and different people will do it in different ways. The linked sample code does it by having two different scripts. This separates the different pieces generating the installer into logical pieces.</p>\n<p><code>install_script.sh</code> only deals with embedding dependencies and fixing the library paths.</p>\n<p><code>build_osx_installer.sh</code> sets up the build with the proper paths, compiles, installs and generates the .dmg package.</p>\n<p>The main reasoning here is that in order to build a complete OSX installer package from source, all you need to do is to cd into the source tree and run <code>./build_osx_installer.sh</code>. To build packages on other platforms you would write scripts such as <code>build_windows_installer.bat</code> and so on.</p>\n\n</div>\n\n\n        "});