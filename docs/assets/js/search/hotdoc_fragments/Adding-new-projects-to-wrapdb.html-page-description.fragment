fragment_downloaded_cb({"url": "Adding-new-projects-to-wrapdb.html#page-description", "fragment": "<div id=\"page-description\" data-hotdoc-source=\"Adding-new-projects-to-wrapdb.md\">\n<h1 id=\"adding-new-projects-to-wrap\">Adding new projects to wrap</h1>\n<p><strong>If you don't have permissions to do something on this page, please open issue against https://github.com/mesonbuild/wrapweb/issues to let us know that you want to start new project.</strong></p>\n<h2 id=\"overview\">Overview</h2>\n<p>The wrap provider service is a simple web service that makes it easy to download build definitions for projects. It works in much the same way as Debian: we take the unaltered upstream source package and add a new build system to it as a patch. These build systems are stored as Git repositories on Github. They only contain build definition files. You may also think of them as an overlay to upstream source.</p>\n<h2 id=\"creator-script\">Creator script</h2>\n<p>The WrapDB repository has a <a href=\"https://github.com/mesonbuild/wrapweb/blob/master/tools/repoinit.py\">helper script</a> to generate new repositories. The documentation below roughly explains what it does using plain shell commands.</p>\n<h2 id=\"choosing-the-repository-name\">Choosing the repository name</h2>\n<p>Wrapped subprojects are used much like external dependencies. Thus they should have the same name as the upstream projects. If the project provides a pkg-config file, then the repository name should be the same as the pkg-config name. Usually this is the name of the project, such as <code>libpng</code>. Sometimes it is slightly different, however. As an example the libogg project's chosen pkg-config name is <code>ogg</code> instead of <code>libogg</code>, which is the reason why the repository is named plain <code>ogg</code>.</p>\n<h2 id=\"adding-new-project-to-the-wrap-provider-service\">Adding new project to the Wrap provider service</h2>\n<p>Each project gets its own repo. It is initialised like this:</p>\n<pre><code>git init\ngit add readme.txt\ngit commit -a -m 'Start of project foobar.'\ngit tag commit_zero -a -m 'A tag that helps get revision ids for releases.'\ngit remote add origin &lt;repo url&gt;\ngit push -u origin master\ngit push --tags\n</code></pre>\n<p>Note that this is the <em>only</em> commit that will ever be made to master branch. All other commits are done to branches.</p>\n<p>Repo names must fully match this regexp: <code>[a-z0-9._]+</code>.</p>\n<h2 id=\"adding-a-new-branch-to-an-existing-project\">Adding a new branch to an existing project</h2>\n<p>Create a new branch whose name matches the upstream release number.</p>\n<pre><code>git checkout master\ngit checkout -b 1.0.0\ngit push origin 1.0.0\n(or from Github web page, remember to branch from master)\n</code></pre>\n<p>Branch names must fully match this regexp: <code>[a-z0-9._]+</code>.</p>\n<h2 id=\"adding-a-new-release-to-an-existing-branch\">Adding a new release to an existing branch</h2>\n<p>Here is where the magic happens. Whenever a new commit is pushed into Github's project branch, a new wrap is generated with an incremented version number. All the old releases remain unaltered. New commits are always done via Github merge requests and must be reviewed by someone other than the submitter.</p>\n<p>Note that your Git repo must <em>not</em> contain the subdirectory of the source release. That gets added automatically by the service. You also must <em>not</em> commit any source code from the original tarball into the wrap repository.</p>\n<p>First you need to fork the repository to your own page. Then you can create the first Wrap commit that usually looks something like this.</p>\n<pre><code>tar xzf libfoo_1.0.0.tar.gz\ngit clone -b 1.0.0 git@github.com:yourusername/libfoo.git tmpdir\nmv tmpdir/.git libfoo-1.0.0\nrm -rf tmpdir\ncd libfoo-1.0.0\ngit reset --hard\nemacs upstream.wrap meson.build\n&lt;verify that your project builds and runs&gt;\ngit add upstream.wrap meson.build\ngit commit -a -m 'Created wrap files for libfoo-1.0.0.'\ngit push origin 1.0.0\n</code></pre>\n<p>Now you can file a merge request. Remember to file it against branch 1.0.0 rather than master. Github should do this automatically.</p>\n<h2 id=\"changes-to-original-source\">Changes to original source</h2>\n<p>The point of a wrap is to provide the upstream project with as few changes as possible. Most projects should not contain anything more than a few Meson definition files. Sometimes it may be necessary to add a template header file or something similar. These should be held at a minimum.</p>\n<p>It should especially be noted that there must <strong>not</strong> be any patches to functionality. All such changes must be submitted to upstream. You may also host your own Git repo with the changes if you wish. The Wrap system has native support for Git subprojects.</p>\n<h2 id=\"reviewing-wraps\">Reviewing wraps</h2>\n<p>See <a href=\"Wrap-review-guidelines.html\">Wrap review guidelines</a>.</p>\n\n</div>\n\n\n        "});