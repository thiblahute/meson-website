<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Compiler properties</title>

<link rel="stylesheet" href="assets/css/custom_bootstrap.css" type="text/css">
<link rel="stylesheet" href="assets/css/bootstrap-toc.min.css">
<link rel="stylesheet" href="assets/css/frontend.css" type="text/css">
<link rel="stylesheet" href="assets/css/jquery.mCustomScrollbar.min.css">

<link rel="stylesheet" href="assets/css/prism.css" type="text/css">

<script src="assets/js/mustache.min.js"></script>
<script src="assets/js/jquery.js"></script>
<script src="assets/js/bootstrap.js"></script>
<script src="assets/js/typeahead.jquery.min.js"></script>
<script src="assets/js/search.js"></script>
<script src="assets/js/isotope.pkgd.min.js"></script>
<script src="assets/js/compare-versions.js"></script>
<script src="assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/js/bootstrap-toc.min.js"></script>
<script src="assets/js/utils.js"></script>
<script src="assets/js/tag_filtering.js"></script>
<script src="assets/js/language_switching.js"></script>
<script src="assets/js/navigation.js"></script>


<script src="assets/js/lines_around_headings.js"></script>

<script src="assets/js/prism-core.js"></script>
<script src="assets/js/prism-autoloader.js"></script>
<script src="assets/js/prism_autoloader_path_override.js"></script>
<script src="assets/js/trie.js"></script>


<title>The MesonÂ® Build System</title>
<link rel="icon" type="image/png" href="images/favicon.png">
<link rel="shortcut icon" href="images/favicon.png">

</head>

<body data-spy="scroll" data-target="#toc" data-offset="70">

<nav class="navbar navbar-fixed-top navbar-default">
	<div class="container-fluid">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-wrapper" aria-expanded="false">
				<span class="sr-only">Toggle navigation</span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
			<a id="home-link" class="hotdoc-navbar-brand">
				<img src="images/meson_logo.png" alt="Home" id="home">
			</a>
		</div>
		<div class="navbar-collapse collapse" id="navbar-wrapper">
			<ul class="nav navbar-nav" id="menu">
							</ul>
			<form action="" class="navbar-form navbar-right">
                               <div class="form-group has-feedback">
                                       <input type="text" class="form-control" name="search" id="sidenav-lookup-field" placeholder="search" disabled>
                                       <span class="glyphicon glyphicon-search form-control-feedback"></span>
                               </div>
                       </form>

		</div>
	</div>
</nav>

<main class="page-row page-row-expanded">
<div data-extension="core" data-hotdoc-in-toplevel="True" data-hotdoc-project="Meson-documentation-1.0" data-hotdoc-ref="Compiler-properties.html" class="page_container" id="page-wrapper">
	<div class="row">
		<div class="hidden-xs hidden-sm col-md-3 col-lg-3 col-xl-2" id="sidenav-column">
	<div class="panel panel-collapse" id="sidenav" data-hotdoc-role="navigation">
		<div id="sitenav-wrapper" class="mCustomScrollbar" data-mcs-theme="minimal">
			<div class="sidenav-main-panel-body">
				<div id="site-navigation">
				</div>
			</div>
		</div>
	</div>
</div>

<div class="col-sm-12 col-md-9 col-lg-7 col-xl-8">
	<div id="main">
				
<div id="page-description" data-hotdoc-source="Compiler-properties.md">
<h1 id="compiler-properties">Compiler properties</h1>
<p>Not all compilers and platforms are alike. Therefore Meson provides the tools to detect properties of the system during configure time. To get most of this information, you first need to extract the <em>compiler object</em> from the main <em>meson</em> variable.</p>
<pre><code class="language-meson">compiler = meson.get_compiler('c')
</code></pre>
<p>Here we extract the C compiler. We could also have given the argument <code>cpp</code> to get the C++ compiler, <code>objc</code> to get the objective C compiler and so on. The call is valid for all languages specified in the <em>project</em> declaration. Trying to obtain some other compiler will lead to an unrecoverable error.</p>
<h2 id="system-information">System information</h2>
<p>This is a bit complex and more throughly explained on the page on [cross compilation](Cross compilation). But if you just want to know the operating system your code will run on, issue this command:</p>
<pre><code class="language-meson">host_machine.system()
</code></pre>
<h1 id="compiler-id">Compiler id</h1>
<p>The compiler object has a method called <code>get_id</code>, which returns a lower case string describing the "family" of the compiler. It has one of the following values.</p>
<table>
<thead>
<tr>
<th> Value</th>
<th> Compiler family</th>
</tr>
</thead>
<tbody>
<tr>
<td> gcc</td>
<td> The GNU Compiler Collection</td>
</tr>
<tr>
<td> clang</td>
<td> The Clang compiler</td>
</tr>
<tr>
<td> msvc</td>
<td> Microsoft Visual Studio</td>
</tr>
<tr>
<td> intel</td>
<td> Intel compiler</td>
</tr>
<tr>
<td> pathscale</td>
<td> The Pathscale Fortran compiler</td>
</tr>
<tr>
<td> pgi</td>
<td> The Portland Fortran compiler</td>
</tr>
<tr>
<td> sun</td>
<td> Sun Fortran compiler</td>
</tr>
<tr>
<td> g95</td>
<td> The G95 Fortran compiler</td>
</tr>
<tr>
<td> open64</td>
<td> The Open64 Fortran Compiler</td>
</tr>
<tr>
<td> nagfor</td>
<td> The NAG Fortran compiler</td>
</tr></tbody></table>
<h1 id="does-code-compile">Does code compile?</h1>
<p>Sometimes the only way to test the system is to try to compile some sample code and see if it works. This is a two-phase operation. First we define some code using the multiline string operator:</p>
<pre><code class="language-meson">code = '''#include&lt;stdio.h&gt;
void func() { printf("Compile me.\n"); }
'''
</code></pre>
<p>Then we can run the test.</p>
<pre><code class="language-meson">result = compiler.compiles(code, name : 'basic check')
</code></pre>
<p>The variable <em>result</em> will now contain either <code>true</code> or <code>false</code> depending on whether the compilation succeeded or not. The keyword argument <code>name</code> is optional. If it is specified, Meson will write the result of the check to its log.</p>
<h1 id="does-code-compile-and-link">Does code compile and link?</h1>
<p>Sometimes it is necessary to check whether a certain code fragment not only
compiles, but also links successfully, e.g. to check if a symbol is actually
present in a library. This can be done using the '''.links()''' method on a
compiler object like this:</p>
<pre><code class="language-meson">code = '''#include&lt;stdio.h&gt;
void func() { printf("Compile me.\n"); }
'''
</code></pre>
<p>Then we can run the test.</p>
<pre><code class="language-meson">result = compiler.links(code, args : '-lfoo', name : 'link check')
</code></pre>
<p>The variable <em>result</em> will now contain either <code>true</code> or <code>false</code>
depending on whether the compilation and linking succeeded or not. The keyword
argument <code>name</code> is optional. If it is specified, Meson will write the
result of the check to its log.</p>
<h1 id="compile-and-run-test-application">Compile and run test application</h1>
<p>Here is how you would compile and run a small test application.</p>
<pre><code class="language-meson">code = '''#include&lt;stdio.h&gt;
int main(int argc, char **argv) {
  printf("%s\n", "stdout");
  fprintf(stderr, "%s\n", "stderr");
  return 0;
}
'''
result = compiler.run(code, name : 'basic check')
</code></pre>
<p>The <code>result</code> variable encapsulates the state of the test, which can be extracted with the following methods. The <code>name</code> keyword argument works the same as with <code>compiles</code>.</p>
<p>Method | Return value
-------|----------------
compiled | <code>True</code> if compilation succeeded. If <code>false</code> then all other methods return undefined values.
returncode | The return code of the application as an integer
stdout | Program's standard out as text.
stderr | Program's standard error as text.</p>
<p>Here is an example usage:</p>
<pre><code class="language-meson">if result.stdout().strip() == 'some_value'
  # do something
endif
</code></pre>
<h1 id="does-a-header-exist">Does a header exist?</h1>
<p>Header files provided by different platforms vary quite a lot. Meson has functionality to detect whether a given header file is available on the system. The test is done by trying to compile a simple test program that includes the specified header. The following snippet describes how this feature can be used.</p>
<pre><code class="language-meson">if compiler.has_header('sys/fstat.h')
  # header exists, do something
endif
</code></pre>
<h1 id="expression-size">Expression size</h1>
<p>Often you need to determine the size of a particular element (such as <code>int</code>, <code>wchar_t</code> or <code>char*</code>). Using the <code>compiler</code> variable mentioned above, the check can be done like this.</p>
<pre><code class="language-meson">wcharsize = compiler.sizeof('wchar_t', prefix : '#include&lt;wchar.h&gt;')
</code></pre>
<p>This will put the size of <code>wchar_t</code> as reported by sizeof into variable <code>wcharsize</code>. The keyword argument <code>prefix</code> is optional. If specified its contents is put at the top of the source file. This argument is typically used for setting <code>#include</code> directives in configuration files.</p>
<p>In older versions (&lt;= 0.30) meson would error out if the size could not be determined. Since version 0.31 it returns -1 if the size could not be determined.</p>
<h1 id="does-a-function-exist">Does a function exist?</h1>
<p>Just having a header does say anything about its contents. Sometimes you need to explicitly check if some function exists. This is how we would check whether the function <code>somefunc</code> exists in header <code>someheader.h</code></p>
<pre><code class="language-meson">if compiler.has_function('somefunc', prefix : '#include&lt;someheader.h&gt;')
  # function exists, do whatever is required.
endif
</code></pre>
<h1 id="does-a-structure-contain-a-member">Does a structure contain a member?</h1>
<p>Some platforms have different standard structures. Here's how one would check if a struct called <code>mystruct</code> from header <code>myheader.h&lt;/hh&gt; contains a member called</code>some_member`.</p>
<pre><code class="language-meson">if compiler.has_member('struct mystruct', 'some_member', prefix : '#include&lt;myheader.h&gt;')
  # member exists, do whatever is required
endif
</code></pre>
<h1 id="type-alignment">Type alignment</h1>
<p>Most platforms can't access some data types at any address. For example it is common that a <code>char</code> can be at any address but a 32 bit integer only at locations which are divisible by four. Determining the alignment of data types is simple.</p>
<pre><code class="language-meson">int_alignment = compiler.alignment('int') # Will most likely contain the value 4.
</code></pre>
<h2 id="has-argument">Has argument</h2>
<p>This method tests if the compiler supports a given command line argument. This is implemented by compiling a small file with the given argument.</p>
<pre><code class="language-meson">has_special_flags = compiler.has_argument('-Wspecialthing')
</code></pre>
<p><em>Note</em>: some compilers silently swallow command line arguments they do not understand. Thus this test can not be made 100% reliable.</p>

</div>


        <div id="subpages"></div>
	</div>
	<div id="search_results">
		<p>The results of the search are</p>
	</div>
</div>
<div class="hidden-xs hidden-sm hidden-md col-lg-2 col-xl-2">
	<nav id="toc"></nav>
</div>
	</div>
</div>
</main>


<footer class="page-row">
	<div class="container-fluid">
	<div class="row">
		<div class="hidden-xs hidden-sm col-md-3 col-xl-2"></div>
		<div class="col-sm-12 col-md-9 col-xl-8">
						
<hr>

<div class="license-description">
	<table>
		<tbody>
			<tr>
			<td>
				<em>Content in this page is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a>
				license, unless otherwise noted.</em>
			</td>
			<td>
						<a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0/">
				<img src="assets/CC-BY-SAv4.0.png" class="license-logo">
			</a>
						</td>	
			</tr>
		</tbody>
	</table>
</div>


		</div>
		<div class="hidden-xs col-xl-2"></div>
	</div>
</div>
</footer>

</body>

<script src="assets/js/navbar_offset_scroller.js"></script>
</html>